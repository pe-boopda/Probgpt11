import { CheckCircle, Circle, Square, CheckSquare } from 'lucide-react';

// Import question type components (you'll need to create these files)
// import ImageAnnotationQuestion from './ImageAnnotationQuestion';
// import MatchingQuestion from './MatchingQuestion';
// import OrderingQuestion from './OrderingQuestion';
// import HotspotQuestion from './HotspotQuestion';
// import FillBlanksQuestion from './FillBlanksQuestion';

// For demo purposes, creating simplified versions inline
const ImageAnnotationQuestion = ({ question, answer, onAnswer }) => (
  <div className="p-4 bg-gray-50 rounded-lg">Image Annotation Component</div>
);

const MatchingQuestion = ({ question, answer, onAnswer }) => (
  <div className="p-4 bg-gray-50 rounded-lg">Matching Component</div>
);

const OrderingQuestion = ({ question, answer, onAnswer }) => (
  <div className="p-4 bg-gray-50 rounded-lg">Ordering Component</div>
);

const HotspotQuestion = ({ question, answer, onAnswer }) => (
  <div className="p-4 bg-gray-50 rounded-lg">Hotspot Component</div>
);

const FillBlanksQuestion = ({ question, answer, onAnswer }) => (
  <div className="p-4 bg-gray-50 rounded-lg">Fill Blanks Component</div>
);

const QuestionView = ({ question, answer, onAnswer }) => {
  const handleMultipleChoice = (optionId) => {
    onAnswer({ selected_option_id: optionId });
  };

  const handleMultipleSelect = (optionId) => {
    const currentIds = answer?.selected_option_ids || [];
    const newIds = currentIds.includes(optionId)
      ? currentIds.filter((id) => id !== optionId)
      : [...currentIds, optionId];
    onAnswer({ selected_option_ids: newIds });
  };

  const handleTextInput = (text) => {
    onAnswer({ text });
  };

  const getQuestionTypeLabel = (type) => {
    const labels = {
      multiple_choice: '–û–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç',
      multiple_select: '–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö',
      true_false: '–ü—Ä–∞–≤–¥–∞/–õ–æ–∂—å',
      text_input: '–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç',
      image_annotation: '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
      matching: '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è',
      ordering: '–£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ',
      hotspot: '–ì–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏',
      fill_blanks: '–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤',
    };
    return labels[type] || type;
  };

  const renderMultipleChoice = () => {
    const selectedId = answer?.selected_option_id;

    return (
      <div className="space-y-3">
        {question.options.map((option) => {
          const isSelected = selectedId === option.id;
          return (
            <button
              key={option.id}
              onClick={() => handleMultipleChoice(option.id)}
              className={`w-full p-4 rounded-lg border-2 transition text-left flex items-center gap-3 ${
                isSelected
                  ? 'border-blue-500 bg-blue-50'
                  : 'border-gray-300 hover:border-gray-400 bg-white'
              }`}
            >
              {isSelected ? (
                <CheckCircle className="w-5 h-5 text-blue-600 flex-shrink-0" />
              ) : (
                <Circle className="w-5 h-5 text-gray-400 flex-shrink-0" />
              )}
              <span
                className={isSelected ? 'text-blue-900 font-medium' : 'text-gray-700'}
              >
                {option.option_text}
              </span>
            </button>
          );
        })}
      </div>
    );
  };

  const renderMultipleSelect = () => {
    const selectedIds = answer?.selected_option_ids || [];

    return (
      <div className="space-y-3">
        {question.options.map((option) => {
          const isSelected = selectedIds.includes(option.id);
          return (
            <button
              key={option.id}
              onClick={() => handleMultipleSelect(option.id)}
              className={`w-full p-4 rounded-lg border-2 transition text-left flex items-center gap-3 ${
                isSelected
                  ? 'border-blue-500 bg-blue-50'
                  : 'border-gray-300 hover:border-gray-400 bg-white'
              }`}
            >
              {isSelected ? (
                <CheckSquare className="w-5 h-5 text-blue-600 flex-shrink-0" />
              ) : (
                <Square className="w-5 h-5 text-gray-400 flex-shrink-0" />
              )}
              <span
                className={isSelected ? 'text-blue-900 font-medium' : 'text-gray-700'}
              >
                {option.option_text}
              </span>
            </button>
          );
        })}
        <p className="text-sm text-gray-600 mt-2">
          üí° –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        </p>
      </div>
    );
  };

  const renderTextInput = () => {
    return (
      <div>
        <textarea
          value={answer?.text || ''}
          onChange={(e) => handleTextInput(e.target.value)}
          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..."
          rows={6}
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
        <p className="text-sm text-gray-600 mt-2">
          –í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
        </p>
      </div>
    );
  };

  return (
    <div className="bg-white rounded-lg shadow p-6">
      {/* Question Header */}
      <div className="mb-6">
        <div className="flex items-center gap-3 mb-3">
          <span className="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
            {getQuestionTypeLabel(question.question_type)}
          </span>
          <span className="text-sm text-gray-600">{question.points} –±–∞–ª–ª(–∞)</span>
        </div>
        <h2 className="text-xl font-semibold text-gray-900">
          {question.question_text}
        </h2>
      </div>

      {/* Question Body - Different rendering based on type */}
      <div>
        {(question.question_type === 'multiple_choice' ||
          question.question_type === 'true_false') &&
          renderMultipleChoice()}
        
        {question.question_type === 'multiple_select' && renderMultipleSelect()}
        
        {question.question_type === 'text_input' && renderTextInput()}
        
        {question.question_type === 'image_annotation' && (
          <ImageAnnotationQuestion
            question={question}
            answer={answer}
            onAnswer={onAnswer}
          />
        )}
        
        {question.question_type === 'matching' && (
          <MatchingQuestion
            question={question}
            answer={answer}
            onAnswer={onAnswer}
          />
        )}
        
        {question.question_type === 'ordering' && (
          <OrderingQuestion
            question={question}
            answer={answer}
            onAnswer={onAnswer}
          />
        )}
        
        {question.question_type === 'hotspot' && (
          <HotspotQuestion
            question={question}
            answer={answer}
            onAnswer={onAnswer}
          />
        )}
        
        {question.question_type === 'fill_blanks' && (
          <FillBlanksQuestion
            question={question}
            answer={answer}
            onAnswer={onAnswer}
          />
        )}
      </div>

      {/* Image (for non-annotation and non-hotspot questions) */}
      {question.image_id && 
       question.question_type !== 'image_annotation' && 
       question.question_type !== 'hotspot' && (
        <div className="mt-6">
          <img
            src={`/uploads/${question.image_id}`}
            alt="Question"
            className="max-w-full h-auto rounded-lg border border-gray-300"
          />
        </div>
      )}
    </div>
  );
};

export default QuestionView;